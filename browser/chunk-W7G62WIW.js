import{a as B,b as y,c as q,d as W,f as J,g as Q,h as R,l as Y,n as U}from"./chunk-GXMMSUOJ.js";import{B as a,C as P,Ca as $,G as v,H as u,J as f,L as o,M as n,N as g,Q as A,R as p,S as h,T as F,U as D,V as I,W as s,X as O,a as k,b as T,ba as V,c as C,fa as N,ka as L,ma as z,n as E,na as G,oa as H,r as c,s as m,t as S,u as w,za as j}from"./chunk-VYP6M4VI.js";var K=["mapContainer"];function X(d,x){if(d&1){let e=A();o(0,"div",18),p("click",function(){let t=c(e).$implicit,r=h(2);return m(r.onSelectSuggestion(t.place_id))}),o(1,"div",19),s(2,"\u{1F4CD}"),n(),o(3,"div",20)(4,"div",21)(5,"span",22),s(6),n()(),o(7,"div",23),s(8),n()()()}if(d&2){let e=x.$implicit;a(6),O(e.description),a(2),O(e.description)}}function Z(d,x){if(d&1&&(o(0,"div")(1,"div",15)(2,"h3"),s(3,"Searched Suggestions"),n(),o(4,"div",16),v(5,X,9,2,"div",17),n()()()),d&2){let e=h();a(5),u("ngForOf",e.addressSuggestions)}}function ee(d,x){d&1&&(o(0,"div",48),s(1," Please enter an address type "),n())}function te(d,x){if(d&1&&(o(0,"div",46),g(1,"input",47),v(2,ee,2,0,"div",38),n()),d&2){let e,i,t=h(2);a(),f("error",((e=t.addressForm.get("otherAddressType"))==null?null:e.touched)&&((e=t.addressForm.get("otherAddressType"))==null?null:e.invalid)),a(),u("ngIf",((i=t.addressForm.get("otherAddressType"))==null?null:i.touched)&&((i=t.addressForm.get("otherAddressType"))==null?null:i.invalid))}}function ne(d,x){d&1&&(o(0,"div",48),s(1," House number is required "),n())}function ie(d,x){d&1&&(o(0,"div",48),s(1," Name is required "),n())}function oe(d,x){d&1&&(o(0,"div",48),s(1," Phone number is required "),n())}function re(d,x){if(d&1){let e=A();o(0,"div",24)(1,"div",25)(2,"div",26)(3,"h2"),s(4,"Enter complete address"),n(),o(5,"button",27),p("click",function(){c(e);let t=h();return m(t.closeAddMore())}),S(),o(6,"svg",28),g(7,"path",29),n()()(),w(),o(8,"form",30),p("ngSubmit",function(){c(e);let t=h();return m(t.saveAddress())}),o(9,"div",31)(10,"div",32)(11,"label",33),s(12,"Save address as *"),n(),o(13,"div",34)(14,"button",35),p("click",function(){c(e);let t=h();return m(t.setAddressType("Home"))}),o(15,"span"),s(16,"\u{1F3E0}"),n(),s(17," Home "),n(),o(18,"button",35),p("click",function(){c(e);let t=h();return m(t.setAddressType("Work"))}),o(19,"span"),s(20,"\u{1F3E2}"),n(),s(21," Work "),n(),o(22,"button",35),p("click",function(){c(e);let t=h();return m(t.setAddressType("Hotel"))}),o(23,"span"),s(24,"\u{1F3E8}"),n(),s(25," Hotel "),n(),o(26,"button",35),p("click",function(){c(e);let t=h();return m(t.setAddressType("Other"))}),o(27,"span"),s(28,"\u{1F4CD}"),n(),s(29," Other "),n()(),v(30,te,3,3,"div",36),n(),o(31,"div",32)(32,"label",33),s(33,"Flat/House no/ Building name *"),n(),g(34,"input",37),v(35,ne,2,0,"div",38),n(),o(36,"div",32)(37,"label",33),s(38,"Floor (optional)"),n(),g(39,"input",39),n(),o(40,"div",32)(41,"label",33),s(42,"Tower / Block (optional)"),n(),g(43,"input",40),n(),o(44,"div",32)(45,"label",33),s(46,"Nearby landmark (optional)"),n(),g(47,"input",41),n(),o(48,"div",32)(49,"label",33),s(50,"Your name *"),n(),g(51,"input",42),v(52,ie,2,0,"div",38),n(),o(53,"div",32)(54,"label",33),s(55,"Your phone no *"),n(),g(56,"input",43),v(57,oe,2,0,"div",38),n()(),o(58,"div",44)(59,"button",45),s(60,"Save Address"),n()()()()()}if(d&2){let e,i,t,r,_,b,M,l=h();a(8),u("formGroup",l.addressForm),a(6),f("active",l.isAddressTypeSelected("Home")),a(4),f("active",l.isAddressTypeSelected("Work")),a(4),f("active",l.isAddressTypeSelected("Hotel")),a(4),f("active",l.isAddressTypeSelected("Other")),a(4),u("ngIf",l.isAddressTypeSelected("Other")),a(4),f("error",((e=l.addressForm.get("houseNumber"))==null?null:e.touched)&&((e=l.addressForm.get("houseNumber"))==null?null:e.invalid)),a(),u("ngIf",((i=l.addressForm.get("houseNumber"))==null?null:i.touched)&&((i=l.addressForm.get("houseNumber"))==null?null:i.invalid)),a(4),f("error",((t=l.addressForm.get("floor"))==null?null:t.touched)&&((t=l.addressForm.get("floor"))==null?null:t.invalid)),a(12),f("error",((r=l.addressForm.get("name"))==null?null:r.touched)&&((r=l.addressForm.get("name"))==null?null:r.invalid)),a(),u("ngIf",((_=l.addressForm.get("name"))==null?null:_.touched)&&((_=l.addressForm.get("name"))==null?null:_.invalid)),a(4),f("error",((b=l.addressForm.get("phone"))==null?null:b.touched)&&((b=l.addressForm.get("phone"))==null?null:b.invalid)),u("ngModel",l.phone),a(),u("ngIf",((M=l.addressForm.get("phone"))==null?null:M.touched)&&((M=l.addressForm.get("phone"))==null?null:M.invalid))}}var ue=(()=>{class d{constructor(e,i,t,r,_){this.cdr=e,this.location=i,this.apiService=t,this.fb=r,this.router=_,this.userId=localStorage.getItem("loggedInUserId"),this.searchedText="",this.addressSuggestions=[],this.userLocation=localStorage.getItem("location")?JSON.parse(localStorage.getItem("location")||"{}"):{},this.openAddMorePopup=!1,this.addressForm=this.fb.group({}),this.selectedAddressType="Home",this.phone=localStorage.getItem("phoneNumber"),this.initializeForm()}ngOnInit(){this.latitude=this.userLocation?.coordinate?.lat,this.longitude=this.userLocation?.coordinate?.lng,this.getCurrentLocation()}getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.currentPosition={lat:this.latitude?parseFloat(this.latitude):e.coords.latitude,lng:this.longitude?parseFloat(this.longitude):e.coords.longitude},this.loadMap(this.currentPosition)}):alert("Geolocation is not supported by this browser.")}loadMap(e){let i={center:e,zoom:15};this.map=new google.maps.Map(this.mapContainer.nativeElement,i),this.centerMarker=new google.maps.Marker({position:this.map.getCenter(),map:this.map}),this.map.addListener("center_changed",()=>{this.centerMarker.setPosition(this.map.getCenter())}),this.map.addListener("dragend",()=>{let t=this.map.getCenter();t&&(this.currentPosition={lat:t.lat(),lng:t.lng()},this.updateLocationDetails(this.currentPosition))}),this.updateLocationDetails(this.currentPosition)}updateLocationDetails(e){new google.maps.Geocoder().geocode({location:e},(t,r)=>{r===google.maps.GeocoderStatus.OK?t&&t.length>0&&(console.log("result",t[0]),this.selectedAddress=t[0].formatted_address,console.log("Address:",this.selectedAddress),this.cdr.detectChanges()):console.error("Geocode was not successful for the following reason: "+r)})}onSearchChange(e){return C(this,null,function*(){let i=e.target;this.searchedText=i.value;let t={searchedText:this.searchedText};this.searchedText.length>2&&(yield this.apiService.getDataWithParams("/home/fetchPlaceSuggestions",t).subscribe(r=>{this.addressSuggestions=r.predictions},r=>{console.error("Error fetching location suggestions:",r)}))})}goToCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.currentPosition={lat:e.coords.latitude,lng:e.coords.longitude},this.map.setCenter(new google.maps.LatLng(this.currentPosition.lat,this.currentPosition.lng)),this.updateLocationDetails(this.currentPosition),this.cdr.detectChanges()}):alert("Geolocation is not supported by this browser.")}onSelectSuggestion(e){return C(this,null,function*(){let i={placeId:e};this.searchedText.length>2&&(yield this.apiService.getDataWithParams("/home/fetchSelectedAddressDeatils",i).subscribe(t=>{this.searchedText="";let r=JSON.parse(JSON.stringify(t));console.log("locationDetails",r),console.log("locationDetails.coordinate.lat",r.coordinate.lat),console.log("locationDetails.coordinate.lon",r.coordinate.lon),this.selectedAddress=r.display_address.address_line,this.currentPosition={lat:parseFloat(r.coordinate.lat),lng:parseFloat(r.coordinate.lon)},this.loadMap(this.currentPosition)},t=>{console.error("Error fetching location details:",t)}))})}initializeForm(){this.addressForm=this.fb.group({addressType:["Home",y.required],otherAddressType:[""],houseNumber:["",y.required],floor:[""],towerBlock:[""],landmark:[""],name:["",y.required],phone:["",y.required]})}setAddressType(e){this.selectedAddressType=e,this.addressForm.patchValue({addressType:e})}isAddressTypeSelected(e){return this.selectedAddressType===e}saveAddress(){return C(this,null,function*(){if(this.addressForm.valid){let e=T(k({userId:this.userId},this.addressForm.value),{addressType:this.addressForm.value.addressType==="Other"?this.addressForm.value.otherAddressType:this.addressForm.value.addressType,latitude:this.currentPosition.lat,longitude:this.currentPosition.lng,fullAddress:this.selectedAddress,is_default:0});yield this.apiService.getDataWithParams("/home/addNewAddress",e).subscribe(i=>{i.message==="success"&&i.code===200&&(this.fetchLocationDetails(this.currentPosition.lat,this.currentPosition.lng),this.router.navigate(["/home"]))},i=>{console.error("Error fetching location suggestions:",i)})}else this.markFormFieldsAsTouched()})}markFormFieldsAsTouched(){Object.keys(this.addressForm.controls).forEach(e=>{this.addressForm.get(e)?.markAsTouched()})}fetchLocationDetails(e,i){return C(this,null,function*(){let t={lat:e,lon:i};yield this.apiService.getDataWithParams("/home/getUserLocation",t).subscribe(r=>{localStorage.setItem("location",JSON.stringify(r))},r=>{console.error("Error fetching location details:",r)})})}openAddMore(){return C(this,null,function*(){this.openAddMorePopup=!0})}closeAddMore(){return C(this,null,function*(){this.openAddMorePopup=!1})}goBackToPreviousPage(){this.location.back()}static{this.\u0275fac=function(i){return new(i||d)(P(N),P(L),P($),P(Y),P(j))}}static{this.\u0275cmp=E({type:d,selectors:[["app-add-address"]],viewQuery:function(i,t){if(i&1&&F(K,5),i&2){let r;D(r=I())&&(t.mapContainer=r.first)}},standalone:!0,features:[V],decls:24,vars:3,consts:[["mapContainer",""],[1,"container"],[2,"display","flex","align-items","center"],["width","32","height","31","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"header-icon",3,"click"],["d","M15 18L9 12L15 6","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"search-container-address"],[1,"search-box"],[1,"search-icon"],["type","text","placeholder","Search for area, street name...",3,"input"],[4,"ngIf"],[1,"map-container"],[1,"location-details"],[1,"current-location-btn",3,"click"],[1,"add-more-details-btn",3,"click"],["class","modal-overlay",4,"ngIf"],[1,"saved-addresses"],[1,"address-list"],["class","address-item",3,"click",4,"ngFor","ngForOf"],[1,"address-item",3,"click"],[1,"icon","location-icon"],[1,"address-details"],[1,"address-header"],[1,"address-type"],[1,"address-text"],[1,"modal-overlay"],[1,"modal-content"],[1,"modal-header"],[1,"close-button",3,"click"],["width","24","height","24","viewBox","0 0 24 24"],["d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"],[3,"ngSubmit","formGroup"],[1,"form-content"],[1,"form-group"],[1,"form-label"],[1,"address-type-options"],["type","button",1,"address-type-button",3,"click"],["class","other-address-input",4,"ngIf"],["type","text","formControlName","houseNumber","placeholder","Enter house number",1,"form-input"],["class","error-message",4,"ngIf"],["type","text","formControlName","floor","placeholder","Enter floor number",1,"form-input"],["type","text","formControlName","towerBlock","placeholder","Enter tower or block",1,"form-input"],["type","text","formControlName","landmark","placeholder","Enter nearby landmark",1,"form-input"],["type","text","formControlName","name","placeholder","Enter your name",1,"form-input"],["type","text","formControlName","phone","placeholder","Enter your phone no",1,"form-input",3,"ngModel"],[1,"form-footer"],["type","submit",1,"save-address-btn"],[1,"other-address-input"],["type","text","formControlName","otherAddressType","placeholder","Save as",1,"form-input"],[1,"error-message"]],template:function(i,t){if(i&1){let r=A();o(0,"div",1)(1,"div",2),S(),o(2,"svg",3),p("click",function(){return c(r),m(t.goBackToPreviousPage())}),g(3,"path",4),n(),w(),o(4,"div",5)(5,"div",6)(6,"i",7),s(7,"\u{1F50D}"),n(),o(8,"input",8),p("input",function(b){return c(r),m(t.onSearchChange(b))}),n()()()(),v(9,Z,6,1,"div",9),g(10,"div",10,0),o(12,"div",11)(13,"button",12),p("click",function(){return c(r),m(t.goToCurrentLocation())}),s(14," Go to Current Location "),n(),o(15,"p"),s(16,"Your Order will be delivered to:"),n(),o(17,"p"),s(18),n(),o(19,"button",13),p("click",function(){return c(r),m(t.openAddMore())}),s(20," Add more address details "),o(21,"span"),s(22,">"),n()()(),v(23,re,61,22,"div",14),n()}i&2&&(a(9),u("ngIf",t.searchedText&&t.searchedText.length>2),a(9),O(t.selectedAddress),a(5),u("ngIf",t.openAddMorePopup))},dependencies:[H,z,G,U,J,B,q,W,Q,R],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;max-width:600px;margin:0 auto;box-sizing:border-box;overflow:hidden;position:relative}.map-container[_ngcontent-%COMP%]{height:500px;width:100%;position:relative}.location-details[_ngcontent-%COMP%]{margin-top:20px;padding:10px}.current-location-btn[_ngcontent-%COMP%]{padding:10px 20px;background-color:#4caf50;color:#fff;border:none;border-radius:5px;cursor:pointer;margin:0 auto;display:block;font-size:14px}.add-more-details-btn[_ngcontent-%COMP%]{width:100%;padding:16px;background-color:#4caf50;border:none;color:#333;text-align:left;font-size:14px;cursor:pointer;border-top:1px solid #eee;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;justify-content:center;align-items:flex-end;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;width:100%;max-width:600px;border-radius:20px 20px 0 0;padding:15px;position:relative;max-height:80vh;overflow-y:auto}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.form-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;overflow-x:hidden}.close-button[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer}.address-type-options[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:24px}.address-type-button[_ngcontent-%COMP%]{flex:1;padding:12px;border:1px solid #ddd;border-radius:8px;background:#fff;display:flex;align-items:center;gap:8px;cursor:pointer}.address-type-button.active[_ngcontent-%COMP%]{background:#e8f5e9;border-color:#4caf50;color:#4caf50}.form-group[_ngcontent-%COMP%]{margin-bottom:10px}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#666;font-size:14px}.form-input[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:14px;max-width:-webkit-fill-available}.form-footer[_ngcontent-%COMP%]{background:#fff;border-top:1px solid #eee;position:sticky;bottom:0}.other-address-input[_ngcontent-%COMP%]{margin-top:16px}.save-address-btn[_ngcontent-%COMP%]{width:100%;padding:16px;background:#4caf50;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:500;cursor:pointer}.saved-addresses[_ngcontent-%COMP%]{padding:1rem;border-top:1px solid #eee;margin-top:1rem}.saved-addresses[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#666;margin-bottom:1rem;font-size:.875rem}.saved-addresses[_ngcontent-%COMP%]   .address-list[_ngcontent-%COMP%]   .address-item[_ngcontent-%COMP%]{display:flex;padding:1rem;border-radius:8px;margin-bottom:.5rem;cursor:pointer}.saved-addresses[_ngcontent-%COMP%]   .address-list[_ngcontent-%COMP%]   .address-item[_ngcontent-%COMP%]:hover{background:#f5f5f5}.saved-addresses[_ngcontent-%COMP%]   .address-list[_ngcontent-%COMP%]   .address-item[_ngcontent-%COMP%]   .address-icon[_ngcontent-%COMP%]{width:2rem;height:2rem;background:#fff3e0;border-radius:8px;display:flex;align-items:center;justify-content:center;margin-right:1rem}.saved-addresses[_ngcontent-%COMP%]   .address-list[_ngcontent-%COMP%]   .address-item[_ngcontent-%COMP%]   .address-details[_ngcontent-%COMP%]{flex:1}.saved-addresses[_ngcontent-%COMP%]   .address-list[_ngcontent-%COMP%]   .address-item[_ngcontent-%COMP%]   .address-details[_ngcontent-%COMP%]   .address-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.25rem}.saved-addresses[_ngcontent-%COMP%]   .address-list[_ngcontent-%COMP%]   .address-item[_ngcontent-%COMP%]   .address-details[_ngcontent-%COMP%]   .address-header[_ngcontent-%COMP%]   .address-type[_ngcontent-%COMP%]{font-weight:500}.saved-addresses[_ngcontent-%COMP%]   .address-list[_ngcontent-%COMP%]   .address-item[_ngcontent-%COMP%]   .address-details[_ngcontent-%COMP%]   .address-header[_ngcontent-%COMP%]   .address-label[_ngcontent-%COMP%]{color:#00796b;font-size:.875rem}.saved-addresses[_ngcontent-%COMP%]   .address-list[_ngcontent-%COMP%]   .address-item[_ngcontent-%COMP%]   .address-details[_ngcontent-%COMP%]   .address-text[_ngcontent-%COMP%]{font-size:.875rem;color:#666}.search-container-address[_ngcontent-%COMP%]{padding:1rem;width:-webkit-fill-available}.search-container-address[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{position:relative}.search-container-address[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.75rem 1rem .75rem 2.5rem;border:1px solid #ddd;border-radius:8px;font-size:.875rem;width:-webkit-fill-available}.search-container-address[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#999}.search-container-address[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);color:#999}.error-message[_ngcontent-%COMP%]{color:#dc3545;font-size:12px;margin-top:4px}.form-input.error[_ngcontent-%COMP%]{border-color:#dc3545}.form-input.error[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #dc354540}"]})}}return d})();export{ue as AddAddressComponent};
